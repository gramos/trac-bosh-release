# abort script on any command that exits with a non zero value
set -e

curl https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py > ez_setup.py
python ez_setup.py 

echo "Extracting trac..."
tar xzf trac/Trac-1.0.1.tar.gz

echo "Copying trac to bosh install target..."
cp -r Trac-1.0.1 ${BOSH_INSTALL_TARGET}

cd ${BOSH_INSTALL_TARGET}/Trac-1.0.1

echo "Installing trac..."
python setup.py install

echo "Creating trac project..."
trac-admin /usr/local/mytracproject initenv "My Project" sqlite:db/myproject.db

echo "Giving permissions to /usr/local/mytracproject/conf/trac.ini"
chmod a+r /usr/local/mytracproject/conf/trac.ini
