set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables

# Available variables
# $BOSH_COMPILE_TARGET - where this package & spec'd source files are available
# $BOSH_INSTALL_TARGET - where you copy/install files to be included in package
export HOME=/var/vcap
export PYTHON_BIN=/var/vcap/packages/python/bin/python
export PYTHONPATH=/var/vcap/packages/trac/trac/lib/python/:$BOSH_INSTALL_TARGET/trac/lib/python:/var/vcap/packages/python/lib/lib/python2.7/site-packages/ 

curl https://pypi.python.org/packages/source/s/setuptools/setuptools-1.3.1.tar.gz > setuptools-1.3.1.tar.gz
tar xzf setuptools-1.3.1.tar.gz

cd setuptools-1.3.1
$PYTHON_BIN setup.py install --prefix=/var/vcap/packages/python/lib 
cd ..

echo "Extracting trac..."
tar xzf trac/Trac-1.0.1.tar.gz

echo "Installing trac..."
cd Trac-1.0.1

mkdir -p $BOSH_INSTALL_TARGET/trac/lib/python

$PYTHON_BIN setup.py install --home $BOSH_INSTALL_TARGET/trac

export PATH=$PATH:$BOSH_INSTALL_TARGET/trac/bin

#echo "Creating trac project..."
# trac-admin $BOSH_INSTALL_TARGET/mytracproject initenv "My Project" sqlite:db/myproject.db

#echo "Giving permissions to /usr/local/mytracproject/conf/trac.ini"
#chmod a+r $BOSH_INSTALL_TARGET/mytracproject/conf/trac.ini

